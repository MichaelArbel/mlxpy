<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Conclusion" href="tutorial_conclusion.html" /><link rel="prev" title="3- Reading" href="easy_reading.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2023.03.27 -->
        <title>4- Advanced features - MLXP 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">MLXP 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">MLXP 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="guide.html">Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing.html">Installing MLXP</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Quick start guide</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="tutorial.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tutorial_introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="easy_launching.html">1- Launching</a></li>
<li class="toctree-l3"><a class="reference internal" href="easy_logging.html">2- Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="easy_reading.html">3- Reading</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">4- Advanced features</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_conclusion.html">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mlxp.html">MLXP package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mlxp.launching.html">Launcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlxp.logging.html">Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlxp.reading.html">Reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlxp.scheduling.html">Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlxp.version_managment.html">Version manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlxp.data_structures.html">Data structures</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="advanced-features">
<h1>4- Advanced features<a class="headerlink" href="#advanced-features" title="Permalink to this heading">#</a></h1>
<section id="launching-jobs-using-a-scheduler">
<h2>Launching jobs using a scheduler<a class="headerlink" href="#launching-jobs-using-a-scheduler" title="Permalink to this heading">#</a></h2>
<p>If you have access to an HPC cluster, then you probably use a job scheduler for submitting jobs.
MLXP allows you to combine the ‘multirun’ capabilities of <a class="reference external" href="https://hydra.cc/">hydra</a> with job scheduling to easily submit multiple experiments to a cluster.</p>
<section id="configuring-the-scheduler">
<h3>Configuring the scheduler<a class="headerlink" href="#configuring-the-scheduler" title="Permalink to this heading">#</a></h3>
<p>The scheduler’s options are stored in the MLXP settings file ‘./configs/mlxp.yaml’. By default, the option ‘use_scheduler’ is set to ‘False’, which means that jobs will not be submitted using a scheduler. Additionally, the field ‘scheduler.name’ is set to ‘NoScheduler’ which means that no valid scheduler is defined.
If the settings file ‘./configs/mlxp.yaml’ does not exist or if you set the option ‘mlxp.user_scheduler’ to true while still leaving the ‘scheduler.name’ field in the ‘mlxp.yaml’ as ‘NoScheduler’, you will have access to an interactive platform to set up the scheduler’s options from the terminal when executing the ‘main.py’ file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python main.py +mlxp.use_scheduler=True</span>

<span class="go">No scheduler is configured by default</span>

<span class="go">Would you like to select a default job scheduler now ?  (y/n):</span>

<span class="go">y: The job scheduler configs will be stored in the file ./configs/mlxp.yaml</span>
<span class="go">n: No scheduler will be selected by default.</span>

<span class="go">Please enter your answer (y/n):</span>
</pre></div>
</div>
<p>MLXP provides two options: ‘y’ or ‘n’. If you choose ‘n’, then MLXP skips configuration and tries to execute code without a scheduler. If you choose ‘y’, you’ll be able to set up a scheduler. Let’s select ‘y’:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">You can either choose one of the job schedulers available by default,</span>
<span class="go">or define a custom one by inheriting from the abstract class &lt;class &#39;mlxp.scheduler.Scheduler&#39;&gt; (see documentation)</span>

<span class="go">For a default scheduler, you can choose one from this list:</span>

<span class="go">[&#39;OARScheduler&#39;, &#39;SLURMScheduler&#39;]</span>

<span class="go">For a custom scheduler, you must provide the full name of the user-defined Scheduler subclass (ex. my_app.CustomScheduler):</span>

<span class="go"> Please enter your choice (or hit Enter to skip) :</span>
</pre></div>
</div>
<p>By default, MLXP supports two job schedulers ‘OAR’ and ‘SLURM’.  You can also specify your custom scheduler by defining a class inheriting from the abstract class ‘mlxp.scheduler.Scheduler’ and providing the full name of the class so that MLXP can import it. Here, we select,’OARScheduler’, one of the default schedulers provided by MLXP as we have access to a cluster using the OAR scheduler:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Please enter your choice (or hit Enter to skip): OARScheduler</span>

<span class="go">Setting Scheduler to OARScheduler</span>

<span class="go">Default settings for MLXP will be created in ./configs/mlxp.yaml</span>
</pre></div>
</div>
<p>MLXP then sets up the scheduler, updates/creates the MLXP settings file ‘./configs/mlxp.yaml’ with an option for using ‘OARScheduler’ and continues execution of the code (see next section for what is executed). We can double-check that the MLXP settings file ‘./configs/mlxp.yaml’ was correctly modified:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">./configs/mlxp.yaml</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">logger</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="nt">scheduler</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OARScheduler</span>
<span class="w">  </span><span class="nt">shell_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/bin/bash&#39;</span>
<span class="w">  </span><span class="nt">shell_config_cmd</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="nt">env_cmd</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="nt">cleanup_cmd</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="nt">option_cmd</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="nt">version_manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</div>
<p>You can also directly edit the ‘mlxp.yaml’ file to configure the scheduler (by setting the field scheduler.name to a valid value).
Additionally, there are other options that the scheduler need, and that are, by default, set to an empty string for most of them. The most important option is the ‘option_cmd’ which specifies the resources required by the job.
It contains a list of strings, each string providing some instruction to the scheduler (e.g.: number of cores, wall time, gpu memory). These instructions must follow the syntax required by the scheduler.
Since we are using OAR, these options must follow OAR’s syntax.</p>
</section>
<section id="submitting-job-to-a-cluster-queue">
<h3>Submitting job to a cluster queue<a class="headerlink" href="#submitting-job-to-a-cluster-queue" title="Permalink to this heading">#</a></h3>
<p>After configuring the scheduler or if it was already configured in the MLXP file settings, MLXP falls back into scheduling mode and creates a script for the job that is then launched using the scheduler (here: ‘OAR’).
In the console, you can see the content of the script followed by a message ‘Job launched!’ indicating that the scheduler succeeded in launching the job:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>!/bin/bash
<span class="gp">#</span>OAR<span class="w"> </span>-n<span class="w"> </span>logs/5
<span class="gp">#</span>OAR<span class="w"> </span>-E<span class="w"> </span>absolute_path_to/logs/5/log.stderr
<span class="gp">#</span>OAR<span class="w"> </span>-O<span class="w"> </span>absolute_path_to/logs/5/log.stdout



<span class="go">cd absolute_path_to/tutorial</span>
<span class="go">absolute_path_to/bin/python main.py              +mlxp.logger.forced_log_id=12            +mlxp.logger.parent_log_dir=absolute_path_to/logs             +mlxp.use_scheduler=False            +mlxp.use_version_manager=False</span>

<span class="go">[ADMISSION RULE] Set default walltime to 7200.</span>
<span class="go">[ADMISSION RULE] Modify resource description with type constraints</span>
<span class="go">OAR_JOB_ID=684995</span>

<span class="go">Job launched!</span>
</pre></div>
</div>
<p>Under the woods MLXP first assigns a ‘log_id’ to the run and then creates its corresponding log directory ‘./logs/log_id’ (, using the logger).
Here, log_id=5, since this is the 5th run that we launched in ‘./logs’. Then instead of executing the job, the scheduler creates a script ‘script.sh’ that is saved in ‘./logs/log_id’. This script is then submitted automatically to the OAR cluster queue using the command: ‘sbatch ./script.sh’.
At this point, the program exits after displaying the script along with a message: ‘Job launched!’.
Let’s have a look at the content of the script:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">./logs/5/script.sh</span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#OAR -n logs/5</span>
<span class="c1">#OAR -E absolute_path_to/logs/5/log.stderr</span>
<span class="c1">#OAR -O absolute_path_to/logs/5/log.stdout</span>



<span class="nb">cd</span><span class="w"> </span>absolute_path_to_work_dir
absolute_path_to/python<span class="w"> </span>main.py<span class="w">  </span>+mlxp.logger.forced_log_id<span class="o">=</span><span class="m">5</span>
+mlxp.logger.parent_log_dir<span class="o">=</span>absolute_path_to/logs
+mlxp.use_scheduler<span class="o">=</span>False
+mlxp.use_version_manager<span class="o">=</span>False
</pre></div>
</div>
</div>
<p>Let’s now go through this script:</p>
<ol class="arabic simple">
<li><p>The first line of the script specifies the shell used for running the script. It is determined by the scheduler’s option ‘shell_path’ of the ‘mlxp.yaml’ file settings. We chose to set it to ‘/bin/bash’.</p></li>
<li><p>The next lines specify the OAR resource option provided in ‘option_cmd’. When the script is created,  the OAR directive ‘#OAR’ is automatically added before these options so that the scheduler can interpret them. You can have a look at the OAR documentation for how to set those options.</p></li>
<li><p>The first instruction is to go to the ‘working directory’ set by the launcher (which can be different from the current working directory if we are using the version manager).</p></li>
<li><dl class="simple">
<dt>Finally, we find the instructiosn for executing the ‘main.py’ file with some additional options:</dt><dd><ul class="simple">
<li><p>First, the log_id is forced to be the same as the one assigned for the job during launching (by setting mlxp.logger.forced_log_id=5).</p></li>
<li><p>Then, we make sure that the ‘parent_log_dir’ is also the same as the one we used during job submission to the cluster.</p></li>
<li><p>Finally, the submitted job must no longer use any scheduler or version manager anymore! That is because the script was already submitted to a cluster queue using the scheduler and must readily be executed once a resource is allocated.</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<p>The script is submitted automatically to the OAR cluster queue, so there is no need, in principle, to worry about it.
It is only useful in case you need to debug or re-run an experiment.</p>
<p>We can check that the job is assigned to a cluster queue using the command ‘oarstat’:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oarstat

<span class="go">Job id    S User     Duration   System message</span>
<span class="go">--------- - -------- ---------- ----------------------------------------</span>

<span class="go">684627    R username 1:15:42 R=1,W=192:0:0,J=B (Karma=0.064,quota_ok)</span>
</pre></div>
</div>
<p>Once, the job finishes execution, we can double-check that everything went well by inspecting the directory ‘./logs/5’ which should contain the usual logs and two additional files ‘log.stdout’ and ‘log.stderr’:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">./logs/</span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>logs/
├── 5/
│   ├── metadata/
│   │   ├── config.yaml
│   │   ├── info.yaml
│   │   └── mlxp.yaml
│   ├── metrics/
│   │   ├── train.json
│   │   └── .keys/
│   │        └── metrics.yaml
│   ├── artifacts/
│   │   └── Checkpoint/
│   │       └── last_ckpt.pkl
│   ├── log.stderr
│   ├── log.stdout
│   └── script.sh
│
├──...
</pre></div>
</div>
</div>
</section>
<section id="submitting-several-jobs-to-a-cluster">
<h3>Submitting several jobs to a cluster<a class="headerlink" href="#submitting-several-jobs-to-a-cluster" title="Permalink to this heading">#</a></h3>
<p>You can also launch several jobs to the cluster from a single command! Let’s say, you want to vary the learning rate and use different seeds to test the robustness of the results. You can leverage the power of <a class="reference external" href="https://hydra.cc/">hydra</a> for this!</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>main.py<span class="w"> </span>optimizer.lr<span class="o">=</span>1e-3,1e-2,1e-1<span class="w"> </span><span class="nv">seed</span><span class="o">=</span><span class="m">1</span>,2,3,4<span class="w">  </span>+mlxp.use_scheduler<span class="o">=</span>True
</pre></div>
</div>
<p>Here is what happens:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://hydra.cc/">hydra</a> performs a cross-product of the options provided and creates as many jobs are needed (3x4).</p></li>
<li><p>The MLXP’s logger creates a separate directory for each one of these jobs. Each directory is assigned a unique log_id.</p></li>
<li><p>The scheduler creates a script for each of these jobs in their corresponding directory, then submits these scripts to the cluster queue.</p></li>
</ol>
</section>
</section>
<section id="version-management">
<h2>Version management<a class="headerlink" href="#version-management" title="Permalink to this heading">#</a></h2>
<p>Sometimes, there can be a delay between the time when a job is submitted and when it gets executed. This typically happens when submitting jobs to a cluster queue.
Meanwhile, the development code might have already changed, with some potential bugs introduced!
Without careful version management, it is hard to know for sure what code was used to produce the results.</p>
<section id="mlxp-s-version-manager">
<h3>MLXP’s version manager<a class="headerlink" href="#mlxp-s-version-manager" title="Permalink to this heading">#</a></h3>
<p>MLXP proposes a simple way to avoid these issues by introducing two features:</p>
<ul class="simple">
<li><p>Systematically checking for uncommitted change/ untracked files.</p></li>
<li><p>Systematically copying the code from the git repository containing the executable to another ‘safe’ location based on the latest commit. The code is then run from this location to avoid any interference with changes introduced later to the development code and before executing a job.</p></li>
</ul>
</section>
<section id="using-mlxp-s-version-manager">
<h3>Using MLXP’s version manager<a class="headerlink" href="#using-mlxp-s-version-manager" title="Permalink to this heading">#</a></h3>
<p>Let’s see how this works! We simply need to set the option ‘use_version_manager’ to true. This launches an interactive session where the user can tell the version manager what to do.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>main.py<span class="w"> </span>+mlxp.use_version_manager<span class="o">=</span>True

<span class="go"> There are untracked files in the repository:</span>

<span class="go"> tutorial/logs/</span>

<span class="go"> How would you like to handle untracked files? (a/b/c)</span>

<span class="go"> a: Add untracked files directly from here?</span>
<span class="go"> b: Check again for untracked files (assuming you manually added them).</span>
<span class="go"> c: Ignore untracked files.</span>

<span class="go"> [Untracked files]: Please enter your choice (a/b/c):</span>
</pre></div>
</div>
<p>First, the version manager checks for untracked files and asks the user what to do: either ignore, double-check untracked files or add the files to git.
Here, we just choose option ‘c’ which ignores the untracked directory ‘./logs/’.</p>
<p>The next step is to check for uncommitted changes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">There are uncommitted changes in the repository:</span>

<span class="go">tutorial/main.py</span>

<span class="go">How would you like to handle uncommitted changes? (a/b/c)</span>

<span class="go">a: Create a new automatic commit before launching jobs.</span>
<span class="go">b: Check again for uncommitted changes (assuming you manually committed them).</span>
<span class="go">c: Ignore uncommitted changes.</span>

<span class="go">[Uncommitted changes]: Please enter your choice (a/b/c):</span>
</pre></div>
</div>
<p>We see that there is one uncommitted change. The user can either ignore this, commit the changes from a different interface and check again or commit the changes from the version manager interface. Here, we just choose the option ‘a’ which creates an automatic commit of the changes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Committing changes....</span>

<span class="go">[master e22179c] MLXP: Automatically committing all changes</span>

<span class="go"> 1 files changed, 2 insertions(+), 1 deletions(-)</span>

<span class="go">No more uncommitted changes!</span>
</pre></div>
</div>
<p>Finally, the version manager asks if we want to create a ‘safe’ copy (if it does not already exist) based on the latest commit and from which code will be executed. If not, the code is executed from the current directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Where would you like to run your code from? (a/b):</span>

<span class="go">a: Create a copy of the repository based on the latest commit and execute code from there.</span>
<span class="go">The copy will be created in absolute_path_to/.workdir/mlxp/commit_hash</span>
<span class="go">b: Execute code from the main repository</span>

<span class="go">Please enter your answer (a/b):</span>
</pre></div>
</div>
<p>We choose the safe copy!
The copy is created in a directory named after the latest commit hash during execution time (here, the last commit was the one created by the version manager). MLXP then proceeds to execute the code from that copy:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Creating a copy of the repository at absolute_path_to/.workdir/mlxp/commit_hash</span>
<span class="go">Starting from epoch: 0</span>
<span class="go">Completed training with a learning rate of 10.0</span>
</pre></div>
</div>
<p>We can double check where the code was executed from by inspecting the ‘info.yaml’ file (Note that this is the 4th run, so the file should be located in ./logs/4/)</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">./logs/4/metadata/info.yaml</span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">work_dir</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absolute_path_to/.workdir/mlxp/commit_hash/tutorial</span>
<span class="w"> </span><span class="nt">version_manager</span><span class="p">:</span>
<span class="w">     </span><span class="nt">commit_hash</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">f02c8e5aa1a4c71d348141543a20543a2e4671b4</span>
<span class="w">     </span><span class="nt">repo_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absolute_path_to_repo</span>
<span class="w">     </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dill==0.3.6</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GitPython==3.1.31</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hydra-core==1.3.2</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">omegaconf==2.2.3</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas==1.2.4</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ply==3.11</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PyYAML==6.0</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setuptools==52.0.0.post20210125</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tinydb==4.7.1</span>
</pre></div>
</div>
</div>
<p>If other jobs are submitted later, and if the code did not change meanwhile, then these jobs will also be executed from this same working directory. This avoids copying the same content multiple times.</p>
<p>Finally, a copy of the dependencies used by the code along with their versions is also made in the field ‘requirements’ if the option ‘mlxp.version_manager.compute_requirements’ is set to ‘True’.</p>
</section>
</section>
<section id="using-both-scheduler-and-version-manager">
<h2>Using both scheduler and version manager<a class="headerlink" href="#using-both-scheduler-and-version-manager" title="Permalink to this heading">#</a></h2>
<p>You can combine both features to run several reproducible jobs with a controlled version of the code they use.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>main.py<span class="w"> </span>+optimizer.lr<span class="o">=</span>1e-3,1e-2,1e-1<span class="w"> </span>+seed<span class="o">=</span><span class="m">1</span>,2,3,4<span class="w">  </span>+mlxp.use_scheduler<span class="o">=</span>True<span class="w"> </span>+mlxp.use_version_manager<span class="o">=</span>True
</pre></div>
</div>
<p>In this case, MLXP will go through the following step:</p>
<ol class="arabic simple">
<li><p>MLXP first asks the user to set up a scheduler, if not already configured.</p></li>
<li><p>The version manager asks the user to decide how to handle untracked/uncommitted files and whether or not to create a ‘safe’ directory from which the code will be run.</p></li>
<li><p>Once the user’s choices are entered, the jobs are submitted to the scheduler, and you only need to wait for the results to come!</p></li>
</ol>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="tutorial_conclusion.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Conclusion</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="easy_reading.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">3- Reading</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; Copyright (C) 2023 Michael Arbel
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">4- Advanced features</a><ul>
<li><a class="reference internal" href="#launching-jobs-using-a-scheduler">Launching jobs using a scheduler</a><ul>
<li><a class="reference internal" href="#configuring-the-scheduler">Configuring the scheduler</a></li>
<li><a class="reference internal" href="#submitting-job-to-a-cluster-queue">Submitting job to a cluster queue</a></li>
<li><a class="reference internal" href="#submitting-several-jobs-to-a-cluster">Submitting several jobs to a cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-management">Version management</a><ul>
<li><a class="reference internal" href="#mlxp-s-version-manager">MLXP’s version manager</a></li>
<li><a class="reference internal" href="#using-mlxp-s-version-manager">Using MLXP’s version manager</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-both-scheduler-and-version-manager">Using both scheduler and version manager</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>